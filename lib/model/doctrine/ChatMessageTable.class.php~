<?php

/**
 * ChatMessageTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ChatMessageTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object ChatMessageTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('ChatMessage');
    }

    public function getLastMessages($idOrder, $lastTime=null)
    {
	$query = $this->createQuery('m')
	->where("m.meli_order_id = ?", $idOrder);
    
	if(!is_null($lastTime))
	{
	 $query->andWhere('m.createdAt>=?', $lastTime);
	}
	return $query->execute(null, Doctrine::HYDRATE_ARRAY);
    }
    public function createMessage($idOrder, $idUser, $eventType, $message)
    {
	$chatMessage = new ChatMessage();
	$chatMessage.setMeliOrderId($idOrder);
	$chatMessage.setUserId($idUser);
	$chatMessage.setEventType($eventType);
	$chatMessage.setMessage($message);

	$chatMessage.save();
	return $chatMessage;
    }
}
